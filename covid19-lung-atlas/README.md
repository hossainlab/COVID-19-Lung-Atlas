# COVID-19 Lung Atlas Interactive Explorer

An R Shiny application for exploring single-cell RNA sequencing data from COVID-19 lung tissue.

## Data Source

**Melms et al. (2021)** "A molecular single-cell lung atlas of lethal COVID-19" *Nature*

- GEO Accession: [GSE171524](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE171524)
- DOI: [10.1038/s41586-021-03569-1](https://doi.org/10.1038/s41586-021-03569-1)

## Dataset Summary

- **94,027 cells** from 27 samples (20,000 sampled for visualization)
- **19 COVID-19 patients**, 7 healthy controls
- **9 major cell types** identified
- Single-nucleus RNA sequencing (snRNA-seq)

## Features

### 1. UMAP Explorer
- Interactive UMAP visualization with adjustable point size and opacity
- Color by cell type, condition, sample, or Leiden cluster
- Split view by condition
- Download plot data as CSV

### 2. Gene Expression
- Search and visualize any gene on UMAP (server-side search for fast typing)
- Violin plots comparing COVID vs Control with embedded boxplots
- Dot plot showing expression and percentage expressing by cell type and condition
- Color scale: magma (dark = high expression)

### 3. Gene Signatures (NEW)
- 11 pre-defined COVID-19 relevant gene signatures
- Heatmap of mean expression across cell types (Z-score scaled)
- Violin plots comparing signature scores between conditions per cell type
- UMAP overlay of mean signature score
- Signatures include: Myeloid dysfunction, Efferocytosis, DATP, Fibrosis, T cell exhaustion, Interferon response, Inflammatory cytokines, AT1/AT2, AM/MDM markers

### 4. Differential Expression
- Interactive volcano plots with adjustable thresholds
- Cell type-specific or global analysis
- Searchable/sortable DEG table (up to 200 genes)
- Download filtered DEG table as CSV

### 5. Cell Proportions
- Bar chart comparing proportions by condition (sorted by proportion)
- Pie chart of overall cell type distribution
- Statistical comparison table with color-coded differences

### 6. Sample Explorer (NEW)
- Bar chart of cells per sample colored by condition
- Sample details table (cell count, cell type diversity, dominant type)
- Highlight individual samples on UMAP

### 7. Cell-Cell Interactions
- Ligand-receptor interaction analysis by pathway
- Adjustable fold-change threshold
- Summary of top increased/decreased interactions
- Detailed interaction table with color-coded log2FC values

### 8. About
- Dataset summary with value boxes
- Key findings from the analysis
- Complete analysis pipeline description
- Link to original publication

## Installation

### Requirements
```r
# Run setup.R to install all dependencies
source("setup.R")
```

Or install manually:
```r
install.packages(c("shiny", "shinydashboard", "plotly", "DT",
                    "dplyr", "tidyr", "ggplot2", "viridis"))
```

### Running the App
```r
# From the covid19-lung-atlas directory
shiny::runApp("shiny_app.R")
```

Or from RStudio, open `shiny_app.R` and click "Run App".

## Data Files

All data files are in the `data/` directory:
- `shiny_app_data_umap_sampled.csv` - UMAP coordinates + metadata (20k cells)
- `shiny_app_data_gene_expression.csv` - Expression matrix for key genes
- `shiny_app_data_de_results.csv` - Global DE results (COVID vs Control)
- `shiny_app_data_de_celltype.csv` - Cell type-specific DE results
- `shiny_app_data_interactions.csv` - Ligand-receptor interaction scores

These files are generated by `notebooks/07_prepare_shiny_data.ipynb`.

## Key Findings

1. **Myeloid expansion:** Significant increase in myeloid cells in COVID-19 lungs
2. **Epithelial loss:** Reduced AT1/AT2 alveolar epithelial cells
3. **Pathological fibroblasts:** CTHRC1+ fibroblasts expanded ~2.5-fold
4. **Macrophage dysfunction:** NEAT1/MALAT1 upregulated; AXL/MERTK downregulated
5. **DATP cells:** Damage-associated transient progenitors (KRT8+/CLDN4+) expanded
6. **Fibrosis signatures:** Elevated collagen and ECM gene expression

## Citation

If you use this data or application, please cite:

```
Melms JC, Biermann J, Huang H, et al. A molecular single-cell lung atlas of lethal COVID-19.
Nature. 2021;595(7865):114-119. doi:10.1038/s41586-021-03569-1
```
